<div class="modal fade" id="importModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content border-0 rounded-3 shadow">
            <div class="modal-header">
                <h5 class="modal-title">批量导入</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="关闭"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="importSpaceSelect">导入到</label>
                    <select class="form-select" id="importSpaceSelect">
                        <option value="personal">个人空间</option>
                        {% for membership in team_memberships %}
                            {% if membership.can_manage_entries %}
                            <option value="team:{{ membership.team_id }}">{{ membership.team.name }}（团队）</option>
                            {% endif %}
                        {% endfor %}
                    </select>
                    <div class="form-text">可选择个人空间或具备管理权限的团队空间。</div>
                </div>

                <div class="mb-3">
                    <div class="btn-group" role="group" aria-label="选择导入方式">
                        <input class="btn-check" type="radio" name="importMode" id="importModeManual" value="manual" checked>
                        <label class="btn btn-outline-primary" for="importModeManual">粘贴文本</label>
                        <input class="btn-check" type="radio" name="importMode" id="importModeFile" value="file">
                        <label class="btn btn-outline-primary" for="importModeFile">上传文件</label>
                    </div>
                </div>

                <div id="importManualPanel" class="mb-3">
                    <label class="form-label" for="importManualText">在此粘贴待导入的条目</label>
                    <textarea id="importManualText" class="form-control" rows="8"
                              placeholder="支持 otpauth:// 或 SECRET|名称|分组 格式"></textarea>
                    <div class="form-text">
                        示例：<code>otpauth://totp/GitHub?secret=JBSWY3DPEHPK3PXP&amp;issuer=GitHub</code> 或
                        <code>JBSWY3DPEHPK3PXP|GitHub|工作</code>
                    </div>
                </div>

                <div id="importFilePanel" class="mb-3 d-none">
                    <label class="form-label" for="importFileInput">选择导出文件</label>
                    <input class="form-control" type="file" id="importFileInput" accept=".csv,.json,.txt">
                    <div class="form-text">
                        支持 1Password CSV、Bitwarden CSV、Authy JSON 等常见格式。
                    </div>
                </div>

                <div id="importErrorAlert" class="alert alert-danger d-none" role="alert"></div>
                <div id="importWarningAlert" class="alert alert-warning d-none" role="alert">
                    <ul id="importWarningList" class="mb-0"></ul>
                </div>

                <div id="importPreviewWrapper" class="d-none">
                    <p class="small text-muted mb-2" id="importPreviewSummary">预览结果如下，请确认后导入：</p>
                    <div class="table-responsive border rounded">
                        <table class="table table-sm align-middle mb-0" id="importPreviewTable">
                            <thead class="table-light">
                            <tr>
                                <th scope="col">名称</th>
                                <th scope="col">分组</th>
                                <th scope="col">来源</th>
                                <th scope="col" class="text-nowrap">状态</th>
                                <th scope="col" class="text-nowrap">密钥</th>
                            </tr>
                            </thead>
                            <tbody id="importPreviewBody"></tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-outline-primary" id="importPreviewBtn">预览</button>
                <button type="button" class="btn btn-primary d-none" id="importApplyBtn">确认导入</button>
            </div>
        </div>
    </div>
</div>
